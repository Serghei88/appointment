@attribute [Authorize(Roles = "Administrator")]
@page "/appointments"
@using BlazorServerAppointmentApp.Model
@using Microsoft.EntityFrameworkCore
<h3>Appointments</h3>

<RadzenGrid AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowPaging="true" PageSize="4"
                AllowSorting="true" Data="@Appointments" TItem="AppointmentViewModel" ColumnWidth="200px">
        <Columns>
            <RadzenGridColumn TItem="AppointmentViewModel" Property="Id" Title="Doctor ID" />
            <RadzenGridColumn TItem="AppointmentViewModel" Property="User.Lastname" Title="User" />
            <RadzenGridColumn TItem="AppointmentViewModel" Property="Time" Title="Time" />
        </Columns>
    </RadzenGrid>


@code {
    
    List<AppointmentViewModel> Appointments { get; set; } = new List<AppointmentViewModel>();

    protected override async Task OnInitializedAsync()
    {
        Appointments = await StateProvider.GetAppointments();
    }
    
    [CascadingParameter]
    StateProvider StateProvider { get; set; }

    protected override void OnInitialized() => StateProvider.OnChange += StateHasChanged;
    public void Dispose() => StateProvider.OnChange -= StateHasChanged;
}